<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>KawaiiKamera ‚ô™ Photobooth</title>

  <!-- Bootstrap 5 -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <style>
    :root {
      --aura-pink: #ffb6e6;
      --aura-hot-pink: #ff6fb7;
      --aura-dark: #3b2b40;
      --countdown-pink: #ffd4f6;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        Helvetica, Arial, sans-serif;
      background: radial-gradient(circle at top left, #ffe6f5, #fff0f7 40%, #ffffff);
      color: var(--aura-dark);
    }

    .kawaii-shell {
      max-width: 1100px;
      margin: 2rem auto;
      padding: 1.5rem;
    }

    .kawaii-card {
      background: linear-gradient(
        135deg,
        rgba(255, 182, 230, 0.85),
        rgba(255, 245, 251, 0.95)
      );
      border-radius: 0;
      padding: 1.75rem;
      border: 1px solid #000;
    }

    .kawaii-header {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .kawaii-header h1 {
      font-weight: 700;
      font-size: 2.4rem;
      letter-spacing: 1px;
    }

    .ascii {
      font-size: 1.2rem;
      line-height: 1.2;
      white-space: pre-line;
    }

    .aura-marquee {
      margin-top: 0.8rem;
      border: 1px solid #000;
      background: #ffffff;
      padding: 0.25rem 0;
      overflow: hidden;
      font-size: 0.9rem;
      text-transform: lowercase;
    }

    .aura-marquee-inner {
      display: inline-block;
      white-space: nowrap;
      animation: aura-scroll 10s linear infinite;
    }

    @keyframes aura-scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    .camera-wrapper {
      position: relative;
      border-radius: 0;
      overflow: hidden;
      border: 1px solid #000;
      background: #000;
      aspect-ratio: 4 / 3;
    }

    video#camera {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scaleX(-1); /* mirror selfie */
    }

    .countdown-overlay,
    .flash-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.15s ease;
    }

    .countdown-overlay {
      font-size: 4rem;
      font-weight: 700;
      color: var(--countdown-pink);
      /* no dark background, so it doesn't dim the screen */
      background: transparent;
      text-shadow: 0 0 6px rgba(0, 0, 0, 0.4);
    }

    .flash-overlay {
      background: #ffffff;
    }

    canvas#photoCanvas,
    canvas#stripCanvas {
      display: none;
    }

    .preview-frame {
      margin-top: 1rem;
      border-radius: 0;
      background: #ffffff;
      padding: 0.75rem;
      text-align: center;
      min-height: 120px;
      border: 1px solid #000;
    }

    .preview-frame img {
      max-width: 100%;
      border-radius: 0;
      border: 1px dashed var(--aura-hot-pink);
    }

    .kawaii-btn {
      border-radius: 0;
      border: 1px solid #000;
      font-weight: 600;
      padding: 0.6rem 1.3rem;
      font-size: 0.95rem;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      background: #fff;
      cursor: pointer;
    }

    .kawaii-btn-primary {
      background: var(--aura-hot-pink);
      color: #fff;
      border: 1px solid #000;
    }

    .filter-pill {
      cursor: pointer;
      padding: 0.35rem 0.75rem;
      border-radius: 0;
      border: 1px solid #000;
      background: #fff;
      font-size: 0.8rem;
      margin: 0.2rem;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }

    .filter-pill.active {
      background: var(--aura-pink);
      font-weight: 600;
    }

    .sidebar-kawaii {
      border-radius: 0;
      padding: 1rem 1.25rem;
      background: #ffffff;
      border: 1px dashed #000;
      font-size: 0.9rem;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.25rem 0.75rem;
      font-size: 0.8rem;
      background: #ffffff;
      border: 1px solid #000;
      margin-top: 0.5rem;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #aaa;
    }

    .status-dot.live {
      background: #ff4b8b;
      box-shadow: 0 0 7px rgba(255, 75, 139, 0.7);
    }
  </style>
</head>

<body>
  <div class="kawaii-shell">

    <!-- HEADER -->
    <div class="kawaii-header">
      <div class="ascii">
        Hiii ! :3<br />
        ‚ï≠‚îÄ‚îÄ‚îÄ‡º∫‚ô°‡ºª‚îÄ‚îÄ‚îÄ‚ïÆ
      </div>

      <h1>KawaiiKamera ‚ô™</h1>

      <!-- MARQUEE -->
      <div class="aura-marquee">
        <div class="aura-marquee-inner">
          ‚ÄßÀö‚Çä‚äπ you have aura !! ‚äπ‚ÇäÀö‚Äß ‚ÄßÀö‚Çä‚äπ you have aura !! ‚äπ‚ÇäÀö‚Äß ‚ÄßÀö‚Çä‚äπ you have aura !! ‚äπ‚ÇäÀö‚Äß
        </div>
      </div>
    </div>

    <!-- MAIN CARD -->
    <div class="kawaii-card">
      <div class="row g-4">

        <!-- LEFT SIDE -->
        <div class="col-md-7">
          <div class="camera-wrapper mb-2">
            <video id="camera" autoplay playsinline></video>
            <div id="countdownOverlay" class="countdown-overlay"></div>
            <div id="flashOverlay" class="flash-overlay"></div>
          </div>

          <div class="d-flex flex-wrap gap-2 mb-3">
            <button id="startCameraBtn" class="kawaii-btn kawaii-btn-primary">
              üéÄ Use my camera
            </button>

            <button id="takePhotoBtn" class="kawaii-btn" disabled>
              üì∏ Take a photo
            </button>

            <button id="takeStripBtn" class="kawaii-btn" disabled>
              üéûÔ∏è 4-photo strip
            </button>

            <a
              id="downloadLink"
              class="kawaii-btn kawaii-btn-primary ms-auto disabled"
              href="#"
              download="kawaii-photo.png"
              aria-disabled="true"
            >
              ‚¨áÔ∏è Save photo
            </a>
          </div>

          <div class="status-badge">
            <span class="status-dot" id="statusDot"></span>
            <span id="statusText">Camera not started yet‚Ä¶</span>
          </div>

          <div class="preview-frame mt-3">
            <p class="mb-1 small">Preview ‚ô™</p>
            <img id="previewImage" alt="Your kawaii photo will appear here" />
          </div>

          <canvas id="photoCanvas"></canvas>
          <canvas id="stripCanvas"></canvas>
        </div>

        <!-- RIGHT SIDE -->
        <div class="col-md-5 d-flex flex-column gap-3">
          <div class="sidebar-kawaii">
            <h2>Filters ‚ô°</h2>
            <p class="mb-2 small">Click a filter, then snap your selfie~</p>
            <div id="filtersContainer">
              <!-- Filter pills will be injected here from JS -->
            </div>
          </div>

          <div class="sidebar-kawaii">
            <h2>How it works ‚ô™</h2>
            <ul>
              <li>Click ‚ÄúUse my camera‚Äù and allow access.</li>
              <li>Select a filter: Normal, B&W, or Glitch.</li>
              <li>Take a single photo or 4-photo strip.</li>
              <li>Save it ‚úß</li>
            </ul>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- JAVASCRIPT -->
  <script>
    const video = document.getElementById("camera");
    const startBtn = document.getElementById("startCameraBtn");
    const takeBtn = document.getElementById("takePhotoBtn");
    const takeStripBtn = document.getElementById("takeStripBtn");
    const downloadLink = document.getElementById("downloadLink");
    const previewImage = document.getElementById("previewImage");
    const photoCanvas = document.getElementById("photoCanvas");
    const stripCanvas = document.getElementById("stripCanvas");
    const statusDot = document.getElementById("statusDot");
    const statusText = document.getElementById("statusText");
    const countdownOverlay = document.getElementById("countdownOverlay");
    const flashOverlay = document.getElementById("flashOverlay");
    const filtersContainer = document.getElementById("filtersContainer");

    let currentStream = null;
    let currentFilterKey = "normal";

    // üé® FILTERS: you can tweak CSS values here
    const FILTERS = [
      {
        key: "normal",
        label: "‚úß Normal",
        css: "none",
      },
      {
        key: "bmw", // your B&W filter
        label: "‚òæ B&W",
        css: "grayscale(1) contrast(1.2)",
      },
      {
        key: "glitch",
        label: "‚ö° Glitch",
        css: "contrast(1.3) saturate(1.5) hue-rotate(10deg)",
      },
    ];

    const FILTER_MAP = Object.fromEntries(
      FILTERS.map(f => [f.key, f.css])
    );

    function renderFilters() {
      filtersContainer.innerHTML = "";
      FILTERS.forEach(filter => {
        const pill = document.createElement("span");
        pill.className = "filter-pill";
        if (filter.key === currentFilterKey) pill.classList.add("active");
        pill.dataset.filter = filter.key;
        pill.textContent = filter.label;
        pill.addEventListener("click", () => setFilter(filter.key));
        filtersContainer.appendChild(pill);
      });
    }

    function setFilter(key) {
      currentFilterKey = key;
      video.style.filter = FILTER_MAP[key] || "none";

      document
        .querySelectorAll(".filter-pill")
        .forEach(p =>
          p.classList.toggle("active", p.dataset.filter === key)
        );
    }

    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        currentStream = stream;
        video.srcObject = stream;
        takeBtn.disabled = false;
        takeStripBtn.disabled = false;
        statusText.textContent = "Camera is live ‚ô™ say cheese!";
        statusDot.classList.add("live");
      } catch (err) {
        console.error(err);
        statusText.textContent = "Camera access blocked";
        alert("Please allow camera access.");
      }
    }

    function ensureVideoReady() {
      return !!video.videoWidth && !!video.videoHeight;
    }

    // Countdown overlay: shows 3 ‚Üí 2 ‚Üí 1, pink numbers, no dimming
    function showCountdown(seconds) {
      return new Promise((resolve) => {
        let remaining = seconds;
        countdownOverlay.style.opacity = 1;
        countdownOverlay.textContent = remaining;

        const intervalId = setInterval(() => {
          remaining--;
          if (remaining > 0) {
            countdownOverlay.textContent = remaining;
          } else {
            clearInterval(intervalId);
            countdownOverlay.style.opacity = 0;
            resolve();
          }
        }, 1000);
      });
    }

    // White flash effect (used on strip shots)
    function flashOnce() {
      flashOverlay.style.opacity = 1;
      setTimeout(() => {
        flashOverlay.style.opacity = 0;
      }, 120);
    }

    function captureSingleFrameToCanvas(targetCanvas, x, y, width, height) {
      const ctx = targetCanvas.getContext("2d");
      ctx.filter = FILTER_MAP[currentFilterKey] || "none";

      // mirror horizontally so it matches on-screen preview
      ctx.save();
      ctx.translate(x + width, y);
      ctx.scale(-1, 1);
      ctx.drawImage(video, 0, 0, width, height);
      ctx.restore();
    }

    async function captureSinglePhoto() {
      if (!ensureVideoReady()) return;
      await showCountdown(3); // countdown before the shot

      const width = video.videoWidth;
      const height = video.videoHeight;

      photoCanvas.width = width;
      photoCanvas.height = height;

      const ctx = photoCanvas.getContext("2d");
      ctx.clearRect(0, 0, width, height);

      captureSingleFrameToCanvas(photoCanvas, 0, 0, width, height);

      const url = photoCanvas.toDataURL("image/png");
      previewImage.src = url;
      downloadLink.href = url;
      downloadLink.download = "kawaii-photo.png";
      downloadLink.classList.remove("disabled");
      downloadLink.setAttribute("aria-disabled", "false");
    }

    async function captureStripWithCountdown() {
      if (!ensureVideoReady()) return;

      const singleW = video.videoWidth;
      const singleH = video.videoHeight;
      const cols = 2;
      const rows = 2;

      stripCanvas.width = singleW * cols;
      stripCanvas.height = singleH * rows;

      const ctx = stripCanvas.getContext("2d");
      ctx.clearRect(0, 0, stripCanvas.width, stripCanvas.height);

      const positions = [
        [0, 0],
        [singleW, 0],
        [0, singleH],
        [singleW, singleH],
      ];

      statusText.textContent = "Taking 4 photos‚Ä¶";

      for (let i = 0; i < positions.length; i++) {
        // countdown every time before each shot
        await showCountdown(3);
        flashOnce();
        const [x, y] = positions[i];
        captureSingleFrameToCanvas(stripCanvas, x, y, singleW, singleH);
      }

      const url = stripCanvas.toDataURL("image/png");
      previewImage.src = url;
      downloadLink.href = url;
      downloadLink.download = "kawaii-strip.png";
      downloadLink.classList.remove("disabled");
      downloadLink.setAttribute("aria-disabled", "false");
      statusText.textContent = "4-photo strip ready ‚ô°";
    }

    // Init
    renderFilters();
    setFilter("normal");

    startBtn.onclick = startCamera;
    takeBtn.onclick = captureSinglePhoto;
    takeStripBtn.onclick = captureStripWithCountdown;
  </script>
</body>
</html>
